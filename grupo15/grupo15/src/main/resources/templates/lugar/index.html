<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestión de Lugares - Turnito</title>
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico">
    <link href="/css/styles.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container px-5">
        <a class="navbar-brand" href="/">Turnito</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active" href="/">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="#">About</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Services</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- Page content -->
<div class="container px-5 my-5">
    <div class="card mb-4">
        <div class="card-header text-center">
            <h3 class="m-0">Gestión de Lugares</h3>
        </div>
        <div class="card-body">
            <div class="mb-4">
                <h5>Filtrar por Provincia y Localidad</h5>
				<div class="mb-4 text-end">
				    <button id="btnVerTodos" class="btn btn-outline-primary">Ver todos los lugares</button>
				</div>
                <div class="mb-3">
                    <label class="form-label">Provincia:</label>
                    <select id="selectProvincia" class="form-select">
                        <option value="0">-- Todas las Provincias --</option>
                        <th:block th:each="provincia : ${provincias}">
                            <option th:value="${provincia.id}" th:text="${provincia.nombre}"></option>
                        </th:block>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Localidad:</label>
                    <select id="selectLocalidad" class="form-select">
                        <option value="0">-- Todas las Localidades --</option>
                    </select>
                </div>
            </div>
			
            <h5 class="mb-3">Lugares Disponibles</h5>
            <div class="table-responsive">
                <table class="table table-bordered">
                    <thead class="table-light">
                        <tr>
                            <th>Nombre</th>
                            <th>Dirección</th>
                            <th>Localidad</th>
                        </tr>
                    </thead>
                    <tbody id="tablaLugaresBody">
                        <tr>
                            <td colspan="3">Seleccione una localidad para ver los lugares.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Footer -->

<footer class="py-5 bg-dark">
    <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Turnito 2025</p>
    </div>
	footer {
	    position: fixed;
	    bottom: 0;
	    width: 100%;
	}
</footer>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const selectProvincia = document.getElementById('selectProvincia');
                const selectLocalidad = document.getElementById('selectLocalidad');
                const tablaLugaresBody = document.getElementById('tablaLugaresBody');

                // --- Funciones para Cargar Datos ---

                // Carga las localidades en el selectLocalidad según la provincia seleccionada
				function cargarSelectLocalidades(provinciaId) {
				    selectLocalidad.innerHTML = '<option value="0">-- Todas las Localidades --</option>'; // Resetear select de localidades
				    tablaLugaresBody.innerHTML = `<tr><td colspan="3">Seleccione una localidad para ver los lugares.</td></tr>`; // Limpiar tabla de lugares

				    // Si se selecciona "Todas las Provincias", no hacemos la llamada fetch.
				    if (provinciaId !== '0') {
				        let url = `/lugares/porProvincia?provinciaId=${provinciaId}`;

				        fetch(url)
				            .then(response => {
				                return response.json();
				            })
				            .then(data => {
				                if (data.length === 0) {
				                    let option = document.createElement('option');
				                    option.value = '0'; // Valor 0 para indicar que no hay localidades
				                    option.textContent = 'No hay localidades para esta provincia';
				                    selectLocalidad.appendChild(option);
				                } else {
				                    data.forEach(localidad => {
				                        let option = document.createElement('option');
				                        option.value = localidad.id;
				                        option.textContent = localidad.nombre;
				                        selectLocalidad.appendChild(option);
				                    });
				                }
				            })
				    }
				}
                // Carga los lugares según la localidad seleccionada
				function cargarLugares(localidadId) {
				    tablaLugaresBody.innerHTML = `<tr><td colspan="3">Seleccione una localidad para ver los lugares.</td></tr>`;
				    if (localidadId !== '0') {
				        let url = `/lugares/porLocalidad?localidadId=${localidadId}`;
				        fetch(url)
				            .then(response => {
				                return response.json();
				            })
				            .then(data => {
				                tablaLugaresBody.innerHTML = '';
				                if (data.length === 0) {
				                    let row = document.createElement('tr');
				                    row.innerHTML = `<td colspan="3">No hay lugares para esta localidad.</td>`;
				                    tablaLugaresBody.appendChild(row);
				                } else {
				                    data.forEach(lugar => {
				                        let row = document.createElement('tr');
				                        row.innerHTML = `
				                            <td>${lugar.nombre}</td>
				                            <td>${lugar.direccion ? lugar.direccion.calleYAltura : 'N/A'}</td>
				                            <td>${lugar.direccion.localidad ? lugar.direccion.localidad.nombre : 'N/A'}</td>
				                        `;
				                        tablaLugaresBody.appendChild(row);
				                    });
				                }
				            })
				    }
				}
                // --- Event Listeners ---

                // Al cargar la página, inicializa los selects y tablas
                cargarSelectLocalidades(selectProvincia.value);

                // Cuando cambia la provincia, actualiza el select de localidades y limpia la tabla de lugares
                selectProvincia.addEventListener('change', function() {
                    const provinciaId = this.value;
                    cargarSelectLocalidades(provinciaId);
                });

                // Cuando cambia la localidad, carga las lugares
                selectLocalidad.addEventListener('change', function() {
                    const localidadId = this.value;
                    cargarLugares(localidadId);
                });
				// Botón "Ver todos los lugares"
				document.getElementById('btnVerTodos').addEventListener('click', function() {
				    window.location.href = '/lugares/todos';
				});

            });
        </script>
    </body>
</html>